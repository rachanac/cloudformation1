---
#  - name: Install Apache 2.4
#    apt: name=apache2 state=present update_cache=yes
#  - name: Install  PHP Packages
#    apt: pkg={{ item }} state=latest
#    with_items:
#      - "libapache2-mod-fcgid"
  - name: Start and enable Apache service
    service: name=apache2 state=restarted enabled=yes
  - name: enabled modules
    apache2_module: name="{{item}}" state=present
    with_items:
      - proxy_fcgi
      - setenvif
      - actions
      - fcgid
      - expires
      - rewrite
      - fcgid

  - name: a2enconf php7.1-fpm
    command: a2enconf php7.1-fpm

  - name: configure vhosts
    template: src=vhost.conf dest=/etc/apache2/sites-available/000-{{domain_name}}.conf owner=root group=root mode=0644

  - name: a2ensite 000-{{domain_name}}.conf
    command: a2ensite 000-{{domain_name}}.conf

  - name: Disable default vhost
    command: a2dissite 000-default.conf
         
  - name: copy envvars
    template: src=envvars dest=/etc/apache2/envvars owner=root group=root mode=0644  
    notify: Restart apache2

  - name: Add apache2.conf files
    template: src=apache2.conf dest=/etc/apache2/apache2.conf owner=root group=root mode=0644
    notify: Restart apache2

#  - name: Copy custom script
#    template: src=apachemodule.sh dest=/opt/redux/scripts/sourceguardian.sh owner=root group=root mode=0755

#  - name: Run custom script
#    shell: /opt/redux/scripts/apachemodule.sh
