RewriteEngine On
RewriteCond %{HTTPS} off
#RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
RewriteRule .* https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

<If "%{HTTPS} == 'on'">
 AuthUserFile /etc/httpd/.htpasswd
 AuthName "Secured by AGIX"
 AuthType Basic
 require valid-user
</If>
